1. nano /root/install_openvpn_full.sh //Introduce aceasta comanda si apoi copiaza codul de mai jos, salveaza cu Ctrl+O  enter si Ctrl+X //

#!/bin/bash
set -e

# ==============================
# OpenVPN Install Script complet
# ==============================

SERVER_IP=$(hostname -I | awk '{print $1}')
PORT=1194
PROTO=udp
VPN_SUBNET="10.8.0.0 255.255.255.0"
EASYRSA_DIR=/etc/openvpn/easy-rsa
CLIENT_NAME="client1"

echo "[INFO] Actualizare sistem..."
apt update -y
apt install -y openvpn easy-rsa ufw

echo "[INFO] Configurare Easy-RSA..."
make-cadir "$EASYRSA_DIR"
cd "$EASYRSA_DIR"
./easyrsa init-pki
echo | ./easyrsa build-ca nopass

echo "[INFO] Generare certificat server..."
./easyrsa gen-req server nopass
./easyrsa sign-req server server

echo "[INFO] Generare Diffie-Hellman..."
./easyrsa gen-dh

echo "[INFO] Generare cheie HMAC (tls-crypt)..."
openvpn --genkey --secret /etc/openvpn/ta.key

echo "[INFO] Generare certificat client ($CLIENT_NAME)..."
./easyrsa gen-req $CLIENT_NAME nopass
./easyrsa sign-req client $CLIENT_NAME

echo "[INFO] Configurare server OpenVPN..."
cat > /etc/openvpn/server.conf <<EOF
port $PORT
proto $PROTO
dev tun
ca $EASYRSA_DIR/pki/ca.crt
cert $EASYRSA_DIR/pki/issued/server.crt
key $EASYRSA_DIR/pki/private/server.key
dh $EASYRSA_DIR/pki/dh.pem
auth SHA256
tls-crypt /etc/openvpn/ta.key
server $VPN_SUBNET
ifconfig-pool-persist /var/log/openvpn/ipp.txt
push "redirect-gateway def1 bypass-dhcp"
push "dhcp-option DNS 1.1.1.1"
push "dhcp-option DNS 8.8.8.8"
keepalive 10 120
cipher AES-256-CBC
user nobody
group nogroup
persist-key
persist-tun
status /var/log/openvpn/openvpn-status.log
verb 3
explicit-exit-notify 1
EOF

echo "[INFO] Activare și pornire OpenVPN..."
systemctl enable openvpn@server
systemctl start openvpn@server

echo "[INFO] Configurare firewall (UFW)..."
ufw allow $PORT/$PROTO
ufw allow OpenSSH
ufw disable
echo "y" | ufw enable

echo "[INFO] Creare fișier client OpenVPN..."
mkdir -p /root/client-configs
cat > /root/client-configs/$CLIENT_NAME.ovpn <<EOF
client
dev tun
proto $PROTO
remote $SERVER_IP $PORT
resolv-retry infinite
nobind
persist-key
persist-tun
remote-cert-tls server
auth SHA256
cipher AES-256-CBC
verb 3

<ca>
$(cat $EASYRSA_DIR/pki/ca.crt)
</ca>

<cert>
$(cat $EASYRSA_DIR/pki/issued/$CLIENT_NAME.crt)
</cert>

<key>
$(cat $EASYRSA_DIR/pki/private/$CLIENT_NAME.key)
</key>

<tls-crypt>
$(cat /etc/openvpn/ta.key)
</tls-crypt>
EOF

echo
echo "==============================================================="
echo "[✅] Instalare completă!"
echo "Fișier client generat: /root/client-configs/$CLIENT_NAME.ovpn"
echo
echo "Copiează-l pe PC și importă-l în OpenVPN Client."
echo "Server rulează pe IP: $SERVER_IP:$PORT ($PROTO)"
echo "==============================================================="


2.chmod +x /root/install_openvpn_full.sh  //se da acces de executare pe fisier//

3. ./install_openvpn_full.sh  // comanda pentru instalarea script-ului//

4. Dupa instalare fisierul se gaseste aici : /root/client-configs/client1.ovpn

5. mkdir -p /home/tutorials/client-configs  // creează folderul in locatia afisata //

6. cp /root/client-configs/client1.ovpn /home/tutorials/client-configs/  // copiază fișierul client1.ovpn în folderul nou creat mai sus //

7. Copiem fisierul cu ajutorul WinSCP pe calculatorul dorit. 

8. La linia remote YOUR_PUBLIC_IP 1194 din client1.ovpn se inlocuieste cu IP-ul nostru public sau privat  dupa caz. 
